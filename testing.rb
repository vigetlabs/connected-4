require 'pry'
require 'awesome_print'

class Finding
  attr_accessor :percent_drop, :deccel_time, :accel_time, :max_deccel, :max_accel, :value

  def new?
    @percent_drop.nil?
  end
end
@findings = []

def check_measurements(measurements)
  @finding = Finding.new
  measurements.each_with_index do |value, current_index|
    next if current_index == 0
    # TODO: when streaming measurements in, next if value is the new max
    # TODO: when streaming measurements in, reset best_pair if descending

    # if ascending
    if value > measurements[current_index - 1]
      # find last current_index where value was equal
      # find low
      last_index    = -1
      minimum       = value
      minimum_index = -1

      (current_index - 1).downto(1).each do |i|
        local_value = measurements[i]

        if local_value == value
          last_index = i
          break
        elsif local_value < minimum
          minimum       = local_value
          minimum_index = i
        end
      end
      next if last_index == -1 || minimum == value
      next if current_index - last_index < 40

      max_deccel = (minimum - value) * 1.0 / (minimum_index - last_index)
      max_accel  = (value - minimum) * 1.0 / (current_index - minimum_index)

      if @finding.new? || max_deccel < @finding.max_deccel && max_accel > @finding.max_accel
        @finding.percent_drop = minimum * 1.0 / value
        @finding.deccel_time  = minimum_index - last_index
        @finding.accel_time   = current_index - minimum_index
        @finding.value        = value
        @finding.max_deccel   = max_deccel
        @finding.max_accel    = max_accel
      end
    end
  end

  @findings << @finding
end

# 3 reds
check_measurements([3374,3370,3371,3367,3363,3368,3370,3374,3376,3375,3373,3366,3366,3365,3368,3374,3374,3377,3374,3366,3368,3364,3371,3371,3377,3375,3371,3372,3367,3363,3368,3371,3378,3377,3373,3372,3367,3362,3368,3370,3374,3377,3374,3369,3371,3365,3365,3367,3374,3377,3374,3374,3368,3368,3364,3369,3371,3374,3377,3374,3368,3367,3364,3364,3370,3370,3376,3376,3372,3365,3366,3365,3367,3369,3372,3373,3372,3369,3365,3361,3367,3367,3374,3372,3371,3367,3362,3363,3360,3367,3370,3374,3372,3366,3364,3360,3360,3366,3370,3370,3372,3368,3363,3362,3362,3365,3367,3370,3374,3369,3369,3362,3360,3364,3365,3369,3374,3373,3372,3363,3362,3360,3364,3369,3370,3368,3365,3363,3358,3356,3359,3362,3364,3365,3362,3354,3349,3335,3323,3299,3278,3244,3204,3151,3106,3064,3039,3024,3019,3024,3030,3036,3040,3040,3044,3052,3064,3075,3077,3074,3063,3051,3047,3045,3055,3060,3065,3062,3048,3035,3022,3018,3022,3028,3031,3032,3021,3007,2991,2983,2988,2992,3003,3005,3023,3077,3142,3213,3282,3327,3352,3361,3363,3359,3356,3355,3357,3363,3364,3366,3371,3369,3366,3362,3360,3366,3369,3371,3374,3371,3369,3367,3365,3366,3367,3375,3374,3373,3373,3366,3363,3366,3370,3373,3377,3375,3375,3369,3366,3363,3366,3374,3375,3378,3376,3371,3366,3367,3365,3373,3373,3379,3376,3371,3370,3365,3366,3372,3373,3375,3378,3373,3370,3369,3363,3370,3371,3376,3379,3374,3373,3366,3368,3366,3371,3377,
  ])

check_measurements([3375,3379,3383,3380,3376,3374,3370,3372,3375,3378,3381,3379,3380,3375,3374,3370,3375,3379,3382,3382,3382,3378,3375,3369,3372,3373,3378,3381,3379,3375,3371,3369,3371,3373,3378,3378,3379,3378,3372,3371,3372,3370,3375,3380,3380,3378,3374,3370,3369,3370,3377,3379,3381,3379,3375,3371,3369,3366,3372,3377,3379,3381,3379,3376,3368,3366,3373,3376,3380,3382,3378,3375,3369,3367,3370,3375,3376,3378,3379,3376,3371,3370,3370,3374,3376,3380,3382,3379,3372,3371,3370,3373,3374,3381,3383,3378,3373,3372,3367,3372,3374,3378,3382,3380,3378,3373,3372,3369,3376,3381,3379,3385,3380,3375,3371,3367,3371,3375,3378,3379,3380,3372,3370,3364,3368,3371,3378,3376,3375,3373,3367,3363,3361,3356,3343,3329,3308,3275,3238,3193,3148,3118,3099,3086,3078,3068,3060,3054,3059,3066,3079,3092,3094,3092,3078,3065,3049,3045,3047,3057,3063,3064,3052,3040,3035,3024,3027,3039,3047,3048,3044,3033,3021,3014,3011,3020,3026,3028,3019,3012,3001,3010,3077,3163,3247,3316,3350,3358,3358,3356,3359,3361,3368,3373,3374,3372,3370,3366,3366,3369,3369,3376,3380,3377,3376,3370,3370,3370,3372,3377,3379,3380,3380,3377,3372])

check_measurements([3351,3355,3347,3347,3349,3350,3350,3353,3355,3349,3350,3349,3348,3350,3350,3349,3352,3351,3347,3347,3346,3346,3346,3349,3350,3347,3345,3340,3342,3340,3345,3347,3346,3345,3339,3340,3336,3339,3339,3341,3339,3338,3336,3335,3333,3334,3334,3338,3338,3335,3339,3334,3333,3332,3333,3333,3337,3333,3328,3319,3302,3284,3263,3240,3221,3205,3193,3178,3168,3163,3159,3164,3169,3175,3173,3169,3165,3158,3154,3152,3154,3155,3154,3152,3148,3140,3135,3136,3137,3139,3138,3137,3134,3130,3123,3122,3123,3124,3125,3123,3121,3111,3108,3104,3129,3167,3210,3257,3284,3295,3303,3306,3310,3321,3325,3327,3329,3330,3333,3332,3332,3333,3336,3341,3346,3341,3344,3343,3343,3342,3346,3349,3351,3350,3351,3349,3347,3347,3350,3353,3354,3354,3353,3349,3352,3349,3350,3356,3356,3359,3358,3354,3352,3354,3354,3354,3360,3357,3358,3360,3359,3353,3355,3356,3360,3362,3363,3361,3357,3355,3354,3360,3360,3361,3361,3364,3361,3360,3356,3359,3359,3364,3363,3365,3362,3360,3359,3361,3363,3364,3366,3363,3362,3364,3362,3359,3360,3362,3367,3364,3365,3363,3359,3361,3361,3364,3366,3366,3368,3366,3363,3360,3360,3362,3367,3364,3364,3364,])
check_measurements([3361,3363,3359,3360,3355,3359,3359,3363,3364,3363,3358,3356,3357,3357,3359,3360,3365,3364,3361,3360,3359,3358,3362,3362,3365,3361,3363,3359,3361,3359,3362,3363,3364,3364,3364,3363,3361,3361,3361,3360,3364,3363,3357,3348,3335,3322,3302,3285,3268,3250,3232,3224,3214,3212,3215,3219,3224,3226,3221,3218,3206,3202,3197,3196,3198,3199,3195,3193,3187,3181,3175,3174,3175,3180,3184,3185,3176,3175,3171,3167,3171,3176,3180,3176,3175,3171,3164,3160,3163,3163,3160,3162,3153,3147,3158,3175,3214,3251,3288,3309,3319,3328,3331,3331,3333,3338,3343,3347,3349,3348,3348,3348,3345,3351,3353,3356,3357,3356,3356,3354,3351,3355,3358,3359,3359,3359,3356,3356,3357,3353,3359,3361,3361,3362,3362,3357,3356,3357,3360,3360,3360,3362,3363,3359,3358,3355,3357,3362,3363,3362,3364,3363,3361,3360,3358,3358,3361,3362,3365,3363,3361,3360,3357,3359,3363,3364,3365,3363,3363,3361,3360,3360,3360,3363,3362,3363,3364,3359,3361,3360,3360,3361,3364,3366,3363,3363,3360,3360,3362,3362,3363,3367,3364,3362,])

# hand wave
# check_measurements([2269,2264,2262,2257,2260,2262,2267,2267,2268,2266,2262,2258,2258,2263,2265,2267,2267,2268,2266,2260,2257,2261,2263,2268,2268,2267,2265,2262,2258,2260,2263,2267,2268,2267,2267,2261,2260,2258,2262,2263,2269,2268,2266,2266,2261,2259,2260,2264,2267,2267,2268,2265,2259,2258,2259,2263,2264,2268,2267,2267,2261,2259,2257,2262,2263,2266,2265,2264,2264,2259,2259,2258,2261,2265,2267,2267,2264,2261,2256,2258,2262,2265,2267,2268,2263,2260,2256,2257,2260,2263,2264,2264,2266,2263,2257,2257,2259,2263,2263,2267,2263,2262,2259,2255,2258,2260,2261,2263,2263,2264,2260,2256,2255,2258,2262,2262,2266,2263,2258,2257,2255,2258,2261,2262,2262,2265,2259,2257,2253,2253,2258,2260,2263,2262,2259,2255,2251,2252,2255,2258,2259,2261,2259,2257,2251,2253,2252,2255,2258,2259,2259,2256,2251,2251,2253,2255,2257,2257,2259,2258,2254,2246,2247,2252,2255,2257,2257,2256,2249,2245,2244,2248,2250,2254,2254,2253,2249,2244,2241,2241,2245,2246,2247,2246,2244,2239,2231,2233,2232,2234,2236,2236,2231,2230,2222,2220,2221,2224,2227,2226,2224,2219,2215,2212,2211,2211,2215,2212,2207,2202,2195,2181,2169,2155,2132,2101,2069,2037,2006,1975,1944,1919,1896,1876,1856,1835,1810,1791,1774,1756,1743,1730,1719,1707,1694,1681,1668,1659,1649,1642,1635,1626,1617,1605,1594,1585,1578,1572,1571,1567,1563,1562,1561,1568,1585,1610,1623,1625,1617,1605,1590,1576,1564,1551,1546,1536,1526,1515,1504,1492,1483,1476,1469,1465,1458,1453,1445,1435,1425,1420,1417,1414,1410,1406,1400,1391,1384,1381,1375,1373,1372,1370,1363,1359,1354,1346,1344,1344,1343,1343,1340,1337,1332,1328,1326,1325,1326,1329,1327,1323,1320,1315,1313,1314,1315,1318,1318,1315,1313,1311,1307,1306,1308,1311,1312,1311,1310,1307,1305,1302,1304,1310,1312,1311,1309,1307,1306,1305,1307,1312,1318,1319,1322,1320,1319,1320,1326,1329,1336,1342,1349,1354,1365,1381,1412,1462,1527,1588,1642,1690,1727,1761,1796,1827,1860,1887,1910,1928,1943,1953,1967,1986,2003,2015,2031,2041,2047,2053,2059,2067,2080,2089,2098,2103,2107,2107,2110,2116,2123,2131,2138,2142,2143,2145,2147,2150,2155,2160,2166,2169,2175,2175,2173,2174,2178,2184,2190,2193,2197,2197,2194,2193,2196,2204,2206,2213,2213,2214,2214,2210,2213,2214,2219,2224,2228,2229,2228,2223,2221,2226,2231,2236,2235,2237,2237,2233,2230,2233,2235,2239,2244,2244,2244,2241,2237,2239,2240,2243,2246,2251,2250,2246,2244,2242,2244,2249,2249,2253,2251,2251,2246,2243,2244,2250,2251,2256,2255,2252,2250,2246,2245,2250,2253,2256,2259,2258,2253,2252,2250,2252,2254,2257,2259,2257,2258,2252,2248,2252,2256,2259,2261,2259,2260,2257,2251,2252,2253,2258,2261,2261,2262,2258,2256,2251,2255,2256,2260,2263,2262,2262,2258,2252,2256,2258,2262,2264,2263,2263,2259,2254,2253,2256,2261,2263,2265,2262,2261,2258,2256,2258,2259,2262,2264,2263,2261,2261,2254,2258,2259,2262,2267,2266,2264,2260,2256,2257,2261,2263,2265,2264,2266,2262,2258,2258,2257,2262,2263,2265,2266,2264,2260,2257,2259,2262,2263,2267,2265,2267,2262,2259,2260,2261,2265,2265,2266,2265,2265,2258,2259,2260,2262,2265,2266,2267,2264,2262,2259,2258,2263,2265,2267,2269,2267,2261,2261,2261,2260,2265,2268,2270,2268,2264,2261,2260,2260,2263,2268,2268,2268,2267,2263,2259,2260,2263,2265,2267,2270,2268,2265,2261,2260,2264,2267,2270,2267,2269,2264,2263,2261,2262,2267,2268,2268,2268,2266,2264,])

# fast hand_wave
# check_measurements([2269,2271,2273,2271,2267,2261,2261,2265,2269,2270,2272,2269,2267,2263,2261,2264,2268,2271,2270,2272,2268,2266,2260,2261,2266,2269,2270,2273,2269,2266,2261,2263,2264,2269,2271,2272,2272,2267,2267,2261,2266,2270,2270,2273,2271,2269,2265,2262,2264,2267,2271,2271,2273,2270,2268,2262,2261,2266,2269,2271,2271,2269,2267,2265,2259,2263,2266,2269,2270,2268,2266,2262,2259,2259,2262,2268,2269,2268,2264,2263,2259,2258,2260,2261,2264,2266,2263,2259,2258,2256,2256,2258,2261,2259,2262,2257,2251,2248,2246,2247,2251,2248,2250,2246,2243,2235,2233,2234,2235,2236,2236,2234,2227,2214,2195,2159,2116,2080,2041,2007,1974,1943,1912,1890,1866,1848,1831,1817,1807,1816,1803,1782,1766,1750,1732,1715,1698,1680,1664,1649,1636,1624,1615,1606,1595,1583,1570,1558,1549,1544,1539,1534,1527,1520,1510,1501,1495,1490,1489,1487,1482,1476,1470,1465,1459,1456,1454,1455,1453,1450,1449,1443,1440,1437,1439,1443,1446,1454,1463,1474,1507,1578,1648,1710,1763,1808,1842,1872,1894,1920,1944,1969,1993,2012,2026,2040,2047,2056,2068,2085,2098,2109,2115,2122,2128,2131,2135,2146,2155,2165,2169,2173,2177,2178,2178,2183,2193,2200,2201,2203,2204,2205,2203,2207,2213,2218,2225,2224,2226,2222,2222,2221,2228,2230,2235,2237,2236,2235,2234,2231,2234,2238,2244,2246,2244,2243,2243,2240,2240,2246,2249,2250,2252,2251,2246,2243,2243,2246,2251,2256,2256,2255,2254,2248,2246,2247,2252,2257,2257,2259,2257,2254,2249,2252,2253,2257,2260,2259,2258,2256,2253,2251,2253,2259,2262,2263,2262,2261,2256,2255,2259,2258,2261,2266,2265,2259,2256,2254,2258,2259,2262,2266,2264,2263,2261,2258,2257,2259,2262,2264,2267,2267,2263,2258,2256,2258,2261,2266,2266,2268,2265,2259,2259,2260,2263,2264,2266,2266,2267,2262,2258,2259,2261,2267,2269,2267,2269,2265,2260,2260,2262,2266,2266,2267,2269,2265,2263,2258,2260,2266,2268,2269,])

# bright red
# check_measurements([3258,3255,3255,3255,3255,3259,3256,3255,3253,3257,3256,3258,3255,3259,3259,3254,3253,3256,3254,3258,3255,3254,3255,3256,3257,3252,3253,3253,3257,3255,3254,3253,3257,3255,3256,3255,3255,3257,3257,3255,3256,3253,3252,3256,3256,3255,3256,3255,3254,3254,3255,3254,3257,3258,3256,3259,3258,3254,3254,3253,3258,3257,3256,3257,3258,3254,3256,3252,3254,3258,3254,3258,3257,3253,3254,3252,3254,3254,3254,3254,3257,3253,3253,3252,3254,3252,3252,3255,3253,3251,3251,3253,3251,3252,3251,3252,3250,3251,3253,3249,3251,3248,3249,3249,3250,3251,3248,3249,3249,3251,3246,3251,3249,3250,3246,3245,3244,3247,3246,3249,3245,3250,3250,3250,3244,3248,3244,3248,3249,3249,3248,3247,3244,3245,3245,3247,3244,3249,3248,3248,3243,3246,3244,3243,3243,3245,3245,3244,3245,3244,3243,3243,3241,3236,3236,3229,3219,3196,3167,3128,3078,3021,2948,2869,2792,2729,2669,2617,2569,2528,2492,2455,2428,2395,2369,2343,2320,2294,2275,2254,2231,2213,2192,2174,2158,2140,2123,2110,2099,2088,2078,2068,2060,2055,2047,2046,2039,2035,2032,2022,2020,2015,2013,2012,2009,2007,2003,1995,1989,2006,2146,2364,2594,2773,2890,2967,3012,3051,3079,3103,3121,3137,3152,3160,3171,3179,3183,3188,3197,3200,3203,3208,3209,3214,3218,3219,3220,3225,3223,3225,3226,3229,3231,3231,3232,3232,3235,3233,3235,3235,3236,3234,3235,3236,3236,3237,3239,3237,3239,3237,3239,3242,3238,3238,3239,3242,3239,3242,3239,3243,3241,3241,3242,3239,3239,3242,3238,3243,3244,3243,3243,3240,3241,3239,3239,3240,3245,3245,3244,3245,3240,3241,3242,3245,3244,3245,3241,3243,3241,3242,3240,3241,3245,3243,3245,3243,3246,3241,3242,3243,3243,3243,3245,3244,3245,3245,3244,3243,3242,3248,3243,3245,3247,3244,3243,3245,3245,3248,3247,3243,])

# sticker red
# check_measurements([2210,2210,2210,2211,2207,2203,2203,2205,2210,2209,2211,2209,2207,2205,2203,2205,2206,2211,2212,2212,2207,2205,2201,2201,2207,2208,2210,2211,2210,2206,2203,2203,2204,2208,2208,2212,2208,2208,2203,2202,2205,2206,2207,2209,2212,2207,2205,2202,2202,2205,2208,2210,2211,2208,2206,2202,2200,2203,2208,2208,2210,2208,2206,2203,2200,2202,2207,2208,2211,2209,2208,2202,2202,2202,2203,2208,2210,2208,2207,2203,2199,2199,2204,2207,2207,2208,2207,2207,2203,2199,2203,2207,2210,2209,2209,2209,2205,2202,2204,2206,2210,2208,2209,2209,2204,2201,2199,2199,2199,2202,2199,2198,2194,2187,2183,2181,2182,2181,2179,2178,2176,2167,2165,2161,2156,2140,2119,2092,2056,2018,1971,1930,1889,1848,1814,1775,1741,1704,1670,1640,1614,1590,1564,1540,1516,1490,1465,1438,1413,1388,1365,1341,1318,1299,1276,1255,1237,1221,1204,1186,1173,1157,1146,1131,1120,1111,1105,1101,1102,1106,1112,1120,1132,1151,1172,1198,1233,1300,1393,1496,1584,1657,1719,1769,1809,1846,1874,1896,1912,1932,1953,1971,1990,2007,2019,2030,2037,2045,2054,2066,2078,2086,2093,2099,2101,2104,2107,2114,2123,2129,2133,2135,2138,2136,2138,2143,2150,2156,2160,2160,2160,2161,2157,2161,2166,2172,2172,2176,2175,2175,2172,2174,2178,2179,2184,2185,2186,2186,2180,2181,2184,2188,2191,2195,2195,2193,2192,2188,2188,2195,2199,2199,2199,2200,2196,2194,2195,2195,2201,2202,2203,2204,2201,2197,2198,2197,2201,2207,2207,2206,2204,2203,2201,2201,
])

# bright sticker red
# check_measurements([3447,3445,3447,3446,3445,3445,3447,3447,3444,3446,3447,3443,3445,3444,3446,3448,3446,3445,3448,3446,3447,3445,3445,3446,3447,3444,3447,3447,3445,3445,3447,3446,3448,3446,3444,3447,3444,3443,3445,3443,3446,3447,3445,3444,3444,3442,3445,3445,3446,3443,3446,3444,3443,3445,3442,3445,3443,3443,3445,3444,3446,3441,3442,3445,3444,3440,3444,3442,3443,3444,3440,3440,3441,3443,3440,3443,3440,3440,3440,3439,3442,3443,3440,3440,3443,3439,3440,3437,3438,3441,3442,3441,3443,3439,3442,3439,3437,3440,3441,3438,3439,3436,3437,3440,3436,3438,3441,3440,3440,3436,3437,3436,3439,3435,3435,3436,3438,3437,3435,3437,3438,3438,3437,3434,3439,3436,3431,3435,3430,3426,3428,3422,3421,3411,3389,3357,3320,3266,3200,3116,3029,2947,2875,2806,2741,2679,2620,2564,2509,2459,2410,2365,2321,2280,2237,2202,2166,2130,2096,2063,2032,2000,1971,1942,1918,1894,1871,1853,1832,1812,1796,1781,1770,1761,1753,1746,1744,1746,1749,1760,1861,2178,2537,2842,3037,3141,3205,3249,3280,3305,3326,3338,3351,3365,3372,3379,3385,3394,3398,3401,3405,3409,3410,3415,3417,3415,3422,3419,3422,3426,3423,3424,3425,3427,3430,3429,3428,3431,3433,3433,3432,3431,3431,3430,3436,3431,3431,3434,3432,3432,3436,3433,3436,3435,3433,3432,3434,3432,3435,3436,3434,3435,3437,3438,3435,3433,3437,3438,3438,3437,3438,3434,3437,3437,3437,3435,3434,3439,3436,3434,3434,3435,3437,3437,3435,3435,3435,3435,3438,3438,3435,3435,3434,3434,3438,3436,3438,3437,3432,3435,3436,3437,3437,3435,3437,3434,3432,3432,3436,3436,3434,])

@findings.map{|a| a.accel_time + a.deccel_time}
@findings.map{|a| -a.max_deccel + a.max_accel}
@findings.map{|a| a.percent_drop}
