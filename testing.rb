require 'pry'
require 'awesome_print'

class Finding
  attr_accessor :percent_drop, :deccel_time, :accel_time, :max_deccel, :max_accel, :value

  def new?
    @percent_drop.nil?
  end
end
@findings = []

def check_measurements(measurements)
  @finding = Finding.new
  measurements.each_with_index do |value, current_index|
    next if current_index == 0
    # TODO: when streaming measurements in, next if value is the new max
    # TODO: when streaming measurements in, reset best_pair if descending

    # if ascending
    if value > measurements[current_index - 1]
      # find last current_index where value was equal
      # find low
      last_index    = -1
      minimum       = value
      minimum_index = -1

      (current_index - 1).downto(1).each do |i|
        local_value = measurements[i]

        if local_value == value
          last_index = i
          break
        elsif local_value < minimum
          minimum       = local_value
          minimum_index = i
        end
      end
      next if last_index == -1 || minimum == value

      max_deccel = (minimum - value) * 1.0 / (minimum_index - last_index)
      max_accel  = (value - minimum) * 1.0 / (current_index - minimum_index)

      if @finding.new? || max_deccel < @finding.max_deccel && max_accel > @finding.max_accel
        @finding.percent_drop = minimum * 1.0 / value
        @finding.deccel_time  = minimum_index - last_index
        @finding.accel_time   = current_index - minimum_index
        @finding.value        = value
        @finding.max_deccel   = max_deccel
        @finding.max_accel    = max_accel
      end
    end
  end

  @findings << @finding
end

# 3 reds
check_measurements([2203,2201,2203,2202,2192,2195,2196,2198,2201,2202,2204,2199,2196,2195,2195,2199,2199,2204,2203,2199,2198,2196,2194,2199,2200,2203,2205,2201,2198,2193,2193,2194,2201,2202,2202,2204,2200,2195,2194,2194,2199,2201,2200,2204,2197,2194,2194,2193,2197,2198,2202,2204,2200,2199,2195,2189,2198,2199,2202,2204,2200,2199,2198,2194,2195,2196,2202,2201,2205,2199,2194,2195,2193,2195,2201,2204,2202,2200,2201,2197,2191,2194,2198,2200,2204,2200,2199,2199,2192,2195,2196,2202,2203,2201,2202,2197,2195,2194,2195,2202,2201,2202,2200,2197,2194,2194,2197,2198,2201,2205,2202,2201,2196,2193,2194,2198,2199,2202,2202,2199,2200,2195,2193,2195,2199,2202,2201,2199,2200,2196,2195,2195,2198,2202,2201,2202,2199,2196,2192,2196,2196,2201,2199,2202,2203,2196,2194,2190,2198,2199,2200,2202,2204,2199,2194,2194,2194,2197,2202,2201,2200,2199,2195,2195,2195,2197,2201,2202,2204,2198,2199,2196,2191,2196,2198,2203,2203,2201,2199,2195,2195,2197,2197,2200,2201,2203,2198,2197,2192,2197,2198,2203,2202,2203,2199,2199,2192,2191,2197,2198,2199,2200,2202,2197,2197,2194,2193,2199,2197,2200,2202,2201,2199,2194,2196,2198,2200,2200,2200,2202,2195,2195,2192,2192,2199,2199,2204,2199,2198,2192,2194,2195,2199,2197,2199,2199,2197,2197,2191,2192,2196,2200,2199,2201,2200,2196,2191,2194,2186,2199,2201,2202,2198,2197,2192,2190,2195,2198,2194,2194,2201,2200,2194,2191,2191,2195,2200,2200,2201,2200,2194,2194,2191,2194,2197,2199,2202,2199,2196,2192,2194,2193,2197,2197,2198,2197,2195,2192,2187,2186,2186,2191,2186,2186,2185,2181,2172,2170,2163,2150,2128,2094,2057,2014,1967,1925,1883,1846,1811,1779,1746,1719,1693,1670,1656,1637,1623,1610,1598,1585,1571,1554,1543,1533,1521,1513,1509,1503,1499,1492,1489,1486,1484,1486,1483,1482,1478,1478,1474,1474,1477,1480,1483,1484,1482,1481,1487,1518,1578,1657,1731,1796,1847,1881,1908,1930,1952,1974,1994,2012,2024,2031,2041,2047,2057,2069,2081,2087,2096,2099,2104,2104,2107,2119,2122,2131,2128,2136,2137,2135,2135,2143,2149,2154,2155,2158,2149,2155,2156,2155,2163,2169,2171,2170,2170,2167,2165,2169,2169,2176,2177,2175,2181,2177,2175,2175,2177,2181,2182,2186,2184,2186,2180,2172,2181,2183,2187,2190,2189,2191,2186,2182,2185,2186,2193,2192,2196,2193,2191,2187,2185,2189,2194,2195,2197,2195,2196,2191,2189,2191,2194,2197,2197,2200,2196,2195,2190,2194,2194,2199,2201,2200,2200,2198,2195,2192,2198,2199,2199,2201,2204,2198,2198,2194,2194,2200,2202,2205,2203,2200,2201,2198,2195,2201,2203,2205,2205,2206,2203,2197,2196,2201,2205,2204,2209,2207,2204,2202,2201,2198,2205,2204,2207,2209,2207,2205,2201,2198,2204,2205])
check_measurements([2217,2213,2210,2208,2211,2215,2217,2216,2219,2214,2212,2210,2211,2214,2217,2220,2215,2216,2212,2209,2209,2212,2217,2219,2217,2217,2213,2209,2208,2210,2215,2216,2216,2215,2215,2209,2209,2213,2213,2215,2219,2216,2214,2213,2210,2208,2211,2216,2215,2217,2217,2211,2208,2209,2210,2214,2218,2219,2216,2213,2209,2208,2211,2213,2216,2215,2218,2216,2213,2208,2208,2214,2214,2216,2219,2217,2212,2210,2209,2210,2212,2216,2219,2214,2212,2208,2209,2210,2214,2218,2218,2216,2213,2212,2207,2208,2214,2217,2218,2216,2217,2211,2207,2207,2212,2215,2214,2215,2217,2214,2208,2206,2210,2214,2213,2216,2215,2212,2211,2205,2207,2209,2212,2215,2214,2213,2211,2207,2206,2210,2212,2213,2212,2211,2211,2207,2206,2205,2209,2211,2213,2212,2212,2206,2205,2205,2209,2210,2214,2211,2213,2207,2202,2203,2202,2207,2206,2205,2200,2196,2191,2189,2190,2189,2192,2192,2186,2185,2180,2167,2150,2128,2097,2058,2010,1966,1924,1884,1848,1813,1781,1753,1725,1698,1673,1653,1633,1618,1605,1589,1578,1566,1554,1542,1529,1518,1509,1502,1492,1481,1474,1461,1451,1444,1434,1433,1430,1428,1426,1424,1423,1420,1423,1426,1429,1432,1432,1433,1430,1432,1431,1437,1440,1445,1446,1449,1450,1473,1521,1591,1672,1747,1806,1852,1888,1913,1938,1959,1981,2002,2019,2030,2041,2048,2056,2067,2078,2086,2095,2102,2110,2112,2115,2119,2126,2134,2137,2142,2148,2146,2145,2148,2150,2159,2165,2167,2169,2169,2165,2166,2168,2174,2179,2182,2181,2181,2183,2179,2179,2183,2190,2189,2192,2190,2192,2186,2186,2189,2193,2196,2199,2199,2196,2196,2191,2195,2198,2200,2201,2204,2204,2202,2198,2198,2199,2205,2206,2208,2206,2206,2202,2198,2203,2204,2210,2209,2211,2208,2202,2200,2203,2207,2208,2210,2210,2212,2206,2201,2205,2207,2209,2213,2214,2213,2209,2205,2206,2208,2212,2212,2213,2214,2212,2208,2204,2206])
check_measurements([2197,2200,2204,2206,2207,2205,2205,2198,2199,2199,2201,2205,2206,2207,2204,2199,2199,2198,2203,2206,2208,2208,2204,2203,2200,2197,2201,2203,2207,2206,2206,2205,2200,2199,2199,2203,2207,2206,2207,2204,2199,2199,2198,2201,2206,2207,2208,2205,2204,2198,2197,2201,2203,2204,2206,2205,2201,2198,2199,2198,2200,2204,2204,2205,2204,2197,2195,2196,2199,2204,2203,2205,2203,2200,2196,2196,2198,2201,2205,2204,2204,2200,2199,2194,2197,2199,2202,2202,2201,2200,2196,2195,2193,2200,2201,2203,2200,2201,2196,2195,2193,2195,2197,2201,2201,2200,2198,2192,2191,2194,2197,2201,2200,2201,2198,2192,2190,2191,2192,2192,2192,2188,2185,2183,2177,2176,2178,2177,2176,2177,2171,2161,2139,2111,2080,2042,1997,1954,1917,1879,1843,1808,1775,1745,1716,1695,1673,1655,1635,1618,1606,1591,1580,1567,1555,1544,1532,1520,1512,1506,1503,1502,1499,1494,1490,1485,1480,1480,1480,1479,1481,1482,1479,1477,1477,1475,1481,1484,1487,1492,1502,1541,1599,1673,1749,1812,1861,1898,1922,1946,1960,1975,1992,2009,2026,2040,2049,2058,2064,2071,2078,2086,2099,2104,2112,2116,2116,2116,2119,2128,2133,2141,2143,2145,2148,2146,2145,2150,2154,2159,2165,2163,2167,2164,2161,2162,2166,2172,2176,2176,2177,2176,2174,2172,2178,2182,2182,2188,2186,2184,2184,2179,2181,2185,2190,2191,2191,2191,2190,2185,2185,2190,2192,2197,2196,2197,2196,2193,2190,2193,2195,2198,2201,2201,2200,2194,2195,2194,2198,2204,2202,2205,2201,2199,2196,2197,2200,2203,2203,2204,2205,2202,2198,2197,2200,2204,2206,2208,2207,2205,2200,2201,2199,2204,2207,2210,2210,2209])

# hand wave
# check_measurements([2269,2264,2262,2257,2260,2262,2267,2267,2268,2266,2262,2258,2258,2263,2265,2267,2267,2268,2266,2260,2257,2261,2263,2268,2268,2267,2265,2262,2258,2260,2263,2267,2268,2267,2267,2261,2260,2258,2262,2263,2269,2268,2266,2266,2261,2259,2260,2264,2267,2267,2268,2265,2259,2258,2259,2263,2264,2268,2267,2267,2261,2259,2257,2262,2263,2266,2265,2264,2264,2259,2259,2258,2261,2265,2267,2267,2264,2261,2256,2258,2262,2265,2267,2268,2263,2260,2256,2257,2260,2263,2264,2264,2266,2263,2257,2257,2259,2263,2263,2267,2263,2262,2259,2255,2258,2260,2261,2263,2263,2264,2260,2256,2255,2258,2262,2262,2266,2263,2258,2257,2255,2258,2261,2262,2262,2265,2259,2257,2253,2253,2258,2260,2263,2262,2259,2255,2251,2252,2255,2258,2259,2261,2259,2257,2251,2253,2252,2255,2258,2259,2259,2256,2251,2251,2253,2255,2257,2257,2259,2258,2254,2246,2247,2252,2255,2257,2257,2256,2249,2245,2244,2248,2250,2254,2254,2253,2249,2244,2241,2241,2245,2246,2247,2246,2244,2239,2231,2233,2232,2234,2236,2236,2231,2230,2222,2220,2221,2224,2227,2226,2224,2219,2215,2212,2211,2211,2215,2212,2207,2202,2195,2181,2169,2155,2132,2101,2069,2037,2006,1975,1944,1919,1896,1876,1856,1835,1810,1791,1774,1756,1743,1730,1719,1707,1694,1681,1668,1659,1649,1642,1635,1626,1617,1605,1594,1585,1578,1572,1571,1567,1563,1562,1561,1568,1585,1610,1623,1625,1617,1605,1590,1576,1564,1551,1546,1536,1526,1515,1504,1492,1483,1476,1469,1465,1458,1453,1445,1435,1425,1420,1417,1414,1410,1406,1400,1391,1384,1381,1375,1373,1372,1370,1363,1359,1354,1346,1344,1344,1343,1343,1340,1337,1332,1328,1326,1325,1326,1329,1327,1323,1320,1315,1313,1314,1315,1318,1318,1315,1313,1311,1307,1306,1308,1311,1312,1311,1310,1307,1305,1302,1304,1310,1312,1311,1309,1307,1306,1305,1307,1312,1318,1319,1322,1320,1319,1320,1326,1329,1336,1342,1349,1354,1365,1381,1412,1462,1527,1588,1642,1690,1727,1761,1796,1827,1860,1887,1910,1928,1943,1953,1967,1986,2003,2015,2031,2041,2047,2053,2059,2067,2080,2089,2098,2103,2107,2107,2110,2116,2123,2131,2138,2142,2143,2145,2147,2150,2155,2160,2166,2169,2175,2175,2173,2174,2178,2184,2190,2193,2197,2197,2194,2193,2196,2204,2206,2213,2213,2214,2214,2210,2213,2214,2219,2224,2228,2229,2228,2223,2221,2226,2231,2236,2235,2237,2237,2233,2230,2233,2235,2239,2244,2244,2244,2241,2237,2239,2240,2243,2246,2251,2250,2246,2244,2242,2244,2249,2249,2253,2251,2251,2246,2243,2244,2250,2251,2256,2255,2252,2250,2246,2245,2250,2253,2256,2259,2258,2253,2252,2250,2252,2254,2257,2259,2257,2258,2252,2248,2252,2256,2259,2261,2259,2260,2257,2251,2252,2253,2258,2261,2261,2262,2258,2256,2251,2255,2256,2260,2263,2262,2262,2258,2252,2256,2258,2262,2264,2263,2263,2259,2254,2253,2256,2261,2263,2265,2262,2261,2258,2256,2258,2259,2262,2264,2263,2261,2261,2254,2258,2259,2262,2267,2266,2264,2260,2256,2257,2261,2263,2265,2264,2266,2262,2258,2258,2257,2262,2263,2265,2266,2264,2260,2257,2259,2262,2263,2267,2265,2267,2262,2259,2260,2261,2265,2265,2266,2265,2265,2258,2259,2260,2262,2265,2266,2267,2264,2262,2259,2258,2263,2265,2267,2269,2267,2261,2261,2261,2260,2265,2268,2270,2268,2264,2261,2260,2260,2263,2268,2268,2268,2267,2263,2259,2260,2263,2265,2267,2270,2268,2265,2261,2260,2264,2267,2270,2267,2269,2264,2263,2261,2262,2267,2268,2268,2268,2266,2264,])

# fast hand_wave
# check_measurements([2269,2271,2273,2271,2267,2261,2261,2265,2269,2270,2272,2269,2267,2263,2261,2264,2268,2271,2270,2272,2268,2266,2260,2261,2266,2269,2270,2273,2269,2266,2261,2263,2264,2269,2271,2272,2272,2267,2267,2261,2266,2270,2270,2273,2271,2269,2265,2262,2264,2267,2271,2271,2273,2270,2268,2262,2261,2266,2269,2271,2271,2269,2267,2265,2259,2263,2266,2269,2270,2268,2266,2262,2259,2259,2262,2268,2269,2268,2264,2263,2259,2258,2260,2261,2264,2266,2263,2259,2258,2256,2256,2258,2261,2259,2262,2257,2251,2248,2246,2247,2251,2248,2250,2246,2243,2235,2233,2234,2235,2236,2236,2234,2227,2214,2195,2159,2116,2080,2041,2007,1974,1943,1912,1890,1866,1848,1831,1817,1807,1816,1803,1782,1766,1750,1732,1715,1698,1680,1664,1649,1636,1624,1615,1606,1595,1583,1570,1558,1549,1544,1539,1534,1527,1520,1510,1501,1495,1490,1489,1487,1482,1476,1470,1465,1459,1456,1454,1455,1453,1450,1449,1443,1440,1437,1439,1443,1446,1454,1463,1474,1507,1578,1648,1710,1763,1808,1842,1872,1894,1920,1944,1969,1993,2012,2026,2040,2047,2056,2068,2085,2098,2109,2115,2122,2128,2131,2135,2146,2155,2165,2169,2173,2177,2178,2178,2183,2193,2200,2201,2203,2204,2205,2203,2207,2213,2218,2225,2224,2226,2222,2222,2221,2228,2230,2235,2237,2236,2235,2234,2231,2234,2238,2244,2246,2244,2243,2243,2240,2240,2246,2249,2250,2252,2251,2246,2243,2243,2246,2251,2256,2256,2255,2254,2248,2246,2247,2252,2257,2257,2259,2257,2254,2249,2252,2253,2257,2260,2259,2258,2256,2253,2251,2253,2259,2262,2263,2262,2261,2256,2255,2259,2258,2261,2266,2265,2259,2256,2254,2258,2259,2262,2266,2264,2263,2261,2258,2257,2259,2262,2264,2267,2267,2263,2258,2256,2258,2261,2266,2266,2268,2265,2259,2259,2260,2263,2264,2266,2266,2267,2262,2258,2259,2261,2267,2269,2267,2269,2265,2260,2260,2262,2266,2266,2267,2269,2265,2263,2258,2260,2266,2268,2269,])

# bright red
check_measurements([3258,3255,3255,3255,3255,3259,3256,3255,3253,3257,3256,3258,3255,3259,3259,3254,3253,3256,3254,3258,3255,3254,3255,3256,3257,3252,3253,3253,3257,3255,3254,3253,3257,3255,3256,3255,3255,3257,3257,3255,3256,3253,3252,3256,3256,3255,3256,3255,3254,3254,3255,3254,3257,3258,3256,3259,3258,3254,3254,3253,3258,3257,3256,3257,3258,3254,3256,3252,3254,3258,3254,3258,3257,3253,3254,3252,3254,3254,3254,3254,3257,3253,3253,3252,3254,3252,3252,3255,3253,3251,3251,3253,3251,3252,3251,3252,3250,3251,3253,3249,3251,3248,3249,3249,3250,3251,3248,3249,3249,3251,3246,3251,3249,3250,3246,3245,3244,3247,3246,3249,3245,3250,3250,3250,3244,3248,3244,3248,3249,3249,3248,3247,3244,3245,3245,3247,3244,3249,3248,3248,3243,3246,3244,3243,3243,3245,3245,3244,3245,3244,3243,3243,3241,3236,3236,3229,3219,3196,3167,3128,3078,3021,2948,2869,2792,2729,2669,2617,2569,2528,2492,2455,2428,2395,2369,2343,2320,2294,2275,2254,2231,2213,2192,2174,2158,2140,2123,2110,2099,2088,2078,2068,2060,2055,2047,2046,2039,2035,2032,2022,2020,2015,2013,2012,2009,2007,2003,1995,1989,2006,2146,2364,2594,2773,2890,2967,3012,3051,3079,3103,3121,3137,3152,3160,3171,3179,3183,3188,3197,3200,3203,3208,3209,3214,3218,3219,3220,3225,3223,3225,3226,3229,3231,3231,3232,3232,3235,3233,3235,3235,3236,3234,3235,3236,3236,3237,3239,3237,3239,3237,3239,3242,3238,3238,3239,3242,3239,3242,3239,3243,3241,3241,3242,3239,3239,3242,3238,3243,3244,3243,3243,3240,3241,3239,3239,3240,3245,3245,3244,3245,3240,3241,3242,3245,3244,3245,3241,3243,3241,3242,3240,3241,3245,3243,3245,3243,3246,3241,3242,3243,3243,3243,3245,3244,3245,3245,3244,3243,3242,3248,3243,3245,3247,3244,3243,3245,3245,3248,3247,3243,])

# sticker red
check_measurements([2210,2210,2210,2211,2207,2203,2203,2205,2210,2209,2211,2209,2207,2205,2203,2205,2206,2211,2212,2212,2207,2205,2201,2201,2207,2208,2210,2211,2210,2206,2203,2203,2204,2208,2208,2212,2208,2208,2203,2202,2205,2206,2207,2209,2212,2207,2205,2202,2202,2205,2208,2210,2211,2208,2206,2202,2200,2203,2208,2208,2210,2208,2206,2203,2200,2202,2207,2208,2211,2209,2208,2202,2202,2202,2203,2208,2210,2208,2207,2203,2199,2199,2204,2207,2207,2208,2207,2207,2203,2199,2203,2207,2210,2209,2209,2209,2205,2202,2204,2206,2210,2208,2209,2209,2204,2201,2199,2199,2199,2202,2199,2198,2194,2187,2183,2181,2182,2181,2179,2178,2176,2167,2165,2161,2156,2140,2119,2092,2056,2018,1971,1930,1889,1848,1814,1775,1741,1704,1670,1640,1614,1590,1564,1540,1516,1490,1465,1438,1413,1388,1365,1341,1318,1299,1276,1255,1237,1221,1204,1186,1173,1157,1146,1131,1120,1111,1105,1101,1102,1106,1112,1120,1132,1151,1172,1198,1233,1300,1393,1496,1584,1657,1719,1769,1809,1846,1874,1896,1912,1932,1953,1971,1990,2007,2019,2030,2037,2045,2054,2066,2078,2086,2093,2099,2101,2104,2107,2114,2123,2129,2133,2135,2138,2136,2138,2143,2150,2156,2160,2160,2160,2161,2157,2161,2166,2172,2172,2176,2175,2175,2172,2174,2178,2179,2184,2185,2186,2186,2180,2181,2184,2188,2191,2195,2195,2193,2192,2188,2188,2195,2199,2199,2199,2200,2196,2194,2195,2195,2201,2202,2203,2204,2201,2197,2198,2197,2201,2207,2207,2206,2204,2203,2201,2201,
])

# bright sticker red
check_measurements([3447,3445,3447,3446,3445,3445,3447,3447,3444,3446,3447,3443,3445,3444,3446,3448,3446,3445,3448,3446,3447,3445,3445,3446,3447,3444,3447,3447,3445,3445,3447,3446,3448,3446,3444,3447,3444,3443,3445,3443,3446,3447,3445,3444,3444,3442,3445,3445,3446,3443,3446,3444,3443,3445,3442,3445,3443,3443,3445,3444,3446,3441,3442,3445,3444,3440,3444,3442,3443,3444,3440,3440,3441,3443,3440,3443,3440,3440,3440,3439,3442,3443,3440,3440,3443,3439,3440,3437,3438,3441,3442,3441,3443,3439,3442,3439,3437,3440,3441,3438,3439,3436,3437,3440,3436,3438,3441,3440,3440,3436,3437,3436,3439,3435,3435,3436,3438,3437,3435,3437,3438,3438,3437,3434,3439,3436,3431,3435,3430,3426,3428,3422,3421,3411,3389,3357,3320,3266,3200,3116,3029,2947,2875,2806,2741,2679,2620,2564,2509,2459,2410,2365,2321,2280,2237,2202,2166,2130,2096,2063,2032,2000,1971,1942,1918,1894,1871,1853,1832,1812,1796,1781,1770,1761,1753,1746,1744,1746,1749,1760,1861,2178,2537,2842,3037,3141,3205,3249,3280,3305,3326,3338,3351,3365,3372,3379,3385,3394,3398,3401,3405,3409,3410,3415,3417,3415,3422,3419,3422,3426,3423,3424,3425,3427,3430,3429,3428,3431,3433,3433,3432,3431,3431,3430,3436,3431,3431,3434,3432,3432,3436,3433,3436,3435,3433,3432,3434,3432,3435,3436,3434,3435,3437,3438,3435,3433,3437,3438,3438,3437,3438,3434,3437,3437,3437,3435,3434,3439,3436,3434,3434,3435,3437,3437,3435,3435,3435,3435,3438,3438,3435,3435,3434,3434,3438,3436,3438,3437,3432,3435,3436,3437,3437,3435,3437,3434,3432,3432,3436,3436,3434,])

@findings.map{|a| a.accel_time + a.deccel_time}
@findings.map{|a| -a.max_deccel + a.max_accel}
@findings.map{|a| a.percent_drop}
